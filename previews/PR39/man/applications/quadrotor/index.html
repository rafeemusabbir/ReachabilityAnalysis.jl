<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quadrotor altitude control · ReachabilityAnalysis.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ReachabilityAnalysis.jl</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../../../introduction/">Introduction</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../setrep/">Set representations</a></li><li><a class="tocitem" href="../../linear/">Linear ODEs</a></li><li><a class="tocitem" href="../../nonlinear/">Nonlinear ODEs</a></li><li><a class="tocitem" href="../../hybrid/">Hybrid systems</a></li><li><a class="tocitem" href="../../parametric/">Parametric reachability</a></li><li><a class="tocitem" href="../../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../../library/">Model library</a></li></ul></li><li><span class="tocitem">Applications</span><ul><li><a class="tocitem" href="../embrake/">Electromechanic break</a></li><li class="is-active"><a class="tocitem" href>Quadrotor altitude control</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#-1"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#**Keywords**:-*hyperelasticity*,-*finite-strain*,-*large-deformations*,-*Newton&#39;s-method*,-1"><span><strong>Keywords</strong>: <em>hyperelasticity</em>, <em>finite strain</em>, <em>large deformations</em>, <em>Newton&#39;s method</em>,</span></a></li><li class="toplevel"><a class="tocitem" href="#*conjugate-gradient*,-*automatic-differentiation*-1"><span><em>conjugate gradient</em>, <em>automatic differentiation</em></span></a></li><li class="toplevel"><a class="tocitem" href="#-2"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#AGREGAR-IMAGEN-DE-QUADROTOR-AQUI-1"><span>AGREGAR IMAGEN DE QUADROTOR AQUI</span></a></li><li class="toplevel"><a class="tocitem" href="#-3"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#In-this-example-we-will-solve-a-problem-in-a-finite-strain-setting-using-an-1"><span>In this example we will solve a problem in a finite strain setting using an</span></a></li><li class="toplevel"><a class="tocitem" href="#hyperelastic-material-model.-In-order-to-compute-the-stress-we-will-use-automatic-1"><span>hyperelastic material model. In order to compute the stress we will use automatic</span></a></li><li class="toplevel"><a class="tocitem" href="#differentiation,-to-solve-the-non-linear-system-we-use-Newton&#39;s-1"><span>differentiation, to solve the non-linear system we use Newton&#39;s</span></a></li><li class="toplevel"><a class="tocitem" href="#method,-and-for-solving-the-Newton-increment-we-use-conjugate-gradient.-1"><span>method, and for solving the Newton increment we use conjugate gradient.</span></a></li><li class="toplevel"><a class="tocitem" href="#-4"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#The-weak-format-is-expressed-in-terms-of-the-first-Piola-Kirchoff-stress-\\mathbf{P}-1"><span>The weak format is expressed in terms of the first Piola-Kirchoff stress <span>$\mathbf{P}$</span></span></a></li><li class="toplevel"><a class="tocitem" href="#as-follows:-Find-u-\\in-\\mathbb{U}-such-that-1"><span>as follows: Find <span>$u \in \mathbb{U}$</span> such that</span></a></li><li class="toplevel"><a class="tocitem" href="#-5"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#math-1"><span>```math</span></a></li><li class="toplevel"><a class="tocitem" href="#\\int_\\Omega-[\\delta-\\mathbf{u}-\\otimes-\\nabla]-:-\\mathbf{P}(\\mathbf{u})\\-\\mathrm{d}\\Omega-1"><span>\int_\Omega [\delta \mathbf{u} \otimes \nabla] : \mathbf{P}(\mathbf{u})\ \mathrm{d}\Omega =</span></a></li><li class="toplevel"><a class="tocitem" href="#\\int*\\Omega-\\delta-\\mathbf{u}-\\cdot-\\mathbf{b}\\-\\mathrm{d}\\Omega-\\int*{\\Gamma\\mathrm{N}}-1"><span>\int<em>\Omega \delta \mathbf{u} \cdot \mathbf{b}\ \mathrm{d}\Omega + \int</em>{\Gamma^\mathrm{N}}</span></a></li><li class="toplevel"><a class="tocitem" href="#\\mathbf{u}-\\cdot-\\mathbf{t}\\-\\mathrm{d}\\Gamma-1"><span>\mathbf{u} \cdot \mathbf{t}\ \mathrm{d}\Gamma</span></a></li><li class="toplevel"><a class="tocitem" href="#\\quad-\\forall-\\delta-\\mathbf{u}-\\in-\\mathbb{U}0,-1"><span>\quad \forall \delta \mathbf{u} \in \mathbb{U}^0,</span></a></li><li class="toplevel"><a class="tocitem" href="#-6"><span>```</span></a></li><li class="toplevel"><a class="tocitem" href="#-7"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#where-\\mathbf{u}-is-the-unknown-displacement-field,-\\mathbf{b}-is-the-body-force,-\\mathbf{t}-1"><span>where <span>$\mathbf{u}$</span> is the unknown displacement field, <span>$\mathbf{b}$</span> is the body force, <span>$\mathbf{t}$</span></span></a></li><li class="toplevel"><a class="tocitem" href="#is-the-traction-on-the-Neumann-part-of-the-boundary,-and-where-\\mathbb{U}-and-\\mathbb{U}0-are-1"><span>is the traction on the Neumann part of the boundary, and where <span>$\mathbb{U}$</span> and <span>$\mathbb{U}^0$</span> are</span></a></li><li class="toplevel"><a class="tocitem" href="#suitable-trial-and-test-sets.-1"><span>suitable trial and test sets.</span></a></li><li class="toplevel"><a class="tocitem" href="###-Hyperelastic-material-model-1"><span>## Hyperelastic material model</span></a></li><li class="toplevel"><a class="tocitem" href="#-8"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#The-stress-can-be-derived-from-an-energy-potential,-defined-in-1"><span>The stress can be derived from an energy potential, defined in</span></a></li><li class="toplevel"><a class="tocitem" href="#terms-of-the-right-Cauchy-Green-tensor-\\mathbf{C}.-We-shall-use-a-neo-Hookean-model,-where-1"><span>terms of the right Cauchy-Green tensor <span>$\mathbf{C}$</span>. We shall use a neo-Hookean model, where</span></a></li><li class="toplevel"><a class="tocitem" href="#the-potential-can-be-written-as-1"><span>the potential can be written as</span></a></li><li class="toplevel"><a class="tocitem" href="#-9"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#math-2"><span>```math</span></a></li><li class="toplevel"><a class="tocitem" href="#\\Psi(\\mathbf{C})-\\frac{\\mu}{2}-(I_C-3)-\\mu-\\ln(J)-\\frac{\\lambda}{2}-\\ln(J)2,-1"><span>\Psi(\mathbf{C}) = \frac{\mu}{2} (I_C - 3) - \mu \ln(J) + \frac{\lambda}{2} \ln(J)^2,</span></a></li><li class="toplevel"><a class="tocitem" href="#-10"><span>```</span></a></li><li class="toplevel"><a class="tocitem" href="#-11"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#where-I_C-\\mathrm{tr}(C),-J-\\sqrt{\\det(C)}-and-\\mu-and-\\lambda-material-parameters.-1"><span>where <span>$I_C = \mathrm{tr}(C)$</span>, <span>$J = \sqrt{\det(C)}$</span> and <span>$\mu$</span> and <span>$\lambda$</span> material parameters.</span></a></li><li class="toplevel"><a class="tocitem" href="#From-the-potential-we-obtain-the-second-Piola-Kirchoff-stress-\\mathbf{S}-as-1"><span>From the potential we obtain the second Piola-Kirchoff stress <span>$\mathbf{S}$</span> as</span></a></li><li class="toplevel"><a class="tocitem" href="#-12"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#math-3"><span>```math</span></a></li><li class="toplevel"><a class="tocitem" href="#\\mathbf{S}-2-\\frac{\\partial-\\Psi}{\\partial-\\mathbf{C}},-1"><span>\mathbf{S} = 2 \frac{\partial \Psi}{\partial \mathbf{C}},</span></a></li><li class="toplevel"><a class="tocitem" href="#-13"><span>```</span></a></li><li class="toplevel"><a class="tocitem" href="#-14"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#and-the-tangent-of-\\mathbf{S}-as-1"><span>and the tangent of <span>$\mathbf{S}$</span> as</span></a></li><li class="toplevel"><a class="tocitem" href="#-15"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#math-4"><span>```math</span></a></li><li class="toplevel"><a class="tocitem" href="#\\frac{\\partial-\\mathbf{S}}{\\partial-\\mathbf{C}}-4-\\frac{\\partial-\\Psi}{\\partial-\\mathbf{C}}.-1"><span>\frac{\partial \mathbf{S}}{\partial \mathbf{C}} = 4 \frac{\partial \Psi}{\partial \mathbf{C}}.</span></a></li><li class="toplevel"><a class="tocitem" href="#-16"><span>```</span></a></li><li class="toplevel"><a class="tocitem" href="#-17"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#We-can-implement-the-material-model-as-follows,-where-we-utilize-automatic-differentiation-1"><span>We can implement the material model as follows, where we utilize automatic differentiation</span></a></li><li class="toplevel"><a class="tocitem" href="#for-the-stress-and-the-tangent,-and-thus-only-define-the-potential:-1"><span>for the stress and the tangent, and thus only define the potential:</span></a></li><li class="toplevel"><a class="tocitem" href="#Finally,-for-the-finite-element-problem-we-need-\\mathbf{P}-and-1"><span>Finally, for the finite element problem we need <span>$\mathbf{P}$</span> and</span></a></li><li class="toplevel"><a class="tocitem" href="#\\frac{\\partial-\\mathbf{P}}{\\partial-\\mathbf{F}},-which-can-be-obtained-by-the-following-1"><span><span>$\frac{\partial \mathbf{P}}{\partial \mathbf{F}}$</span>, which can be obtained by the following</span></a></li><li class="toplevel"><a class="tocitem" href="#transformations-1"><span>transformations</span></a></li><li class="toplevel"><a class="tocitem" href="#-18"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#math-5"><span>```math</span></a></li><li class="toplevel"><a class="tocitem" href="#\\begin{align*}-1"><span>\begin{align*}</span></a></li><li class="toplevel"><a class="tocitem" href="#\\mathbf{P}-and-\\mathbf{F}-\\cdot-\\mathbf{S},\\-1"><span>\mathbf{P} &amp;= \mathbf{F} \cdot \mathbf{S},\</span></a></li><li class="toplevel"><a class="tocitem" href="#\\frac{\\partial-\\mathbf{P}}{\\partial-\\mathbf{F}}-and-[\\mathbf{F}-\\bar{\\otimes}-\\mathbf{I}]-:-1"><span>\frac{\partial \mathbf{P}}{\partial \mathbf{F}} &amp;= [\mathbf{F} \bar{\otimes} \mathbf{I}] :</span></a></li><li class="toplevel"><a class="tocitem" href="#\\frac{\\partial-\\mathbf{S}}{\\partial-\\mathbf{C}}-:-[\\mathbf{F}\\mathrm{T}-\\bar{\\otimes}-\\mathbf{I}]-1"><span>\frac{\partial \mathbf{S}}{\partial \mathbf{C}} : [\mathbf{F}^\mathrm{T} \bar{\otimes} \mathbf{I}]</span></a></li><li class="toplevel"><a class="tocitem" href="#\\mathbf{I}-\\bar{\\otimes}-\\mathbf{S}.-1"><span>+ \mathbf{I} \bar{\otimes} \mathbf{S}.</span></a></li><li class="toplevel"><a class="tocitem" href="#\\end{align*}-1"><span>\end{align*}</span></a></li><li class="toplevel"><a class="tocitem" href="#-19"><span>```</span></a></li><li class="toplevel"><a class="tocitem" href="#-20"><span></span></a></li><li class="toplevel"><a class="tocitem" href="###-Finite-element-assembly-1"><span>## Finite element assembly</span></a></li><li class="toplevel"><a class="tocitem" href="#-21"><span></span></a></li><li class="toplevel"><a class="tocitem" href="#The-element-routine-for-assembling-the-residual-and-tangent-stiffness-is-implemented-1"><span>The element routine for assembling the residual and tangent stiffness is implemented</span></a></li><li class="toplevel"><a class="tocitem" href="#as-usual,-with-loops-over-quadrature-points-and-shape-functions:-1"><span>as usual, with loops over quadrature points and shape functions:</span></a></li><li class="toplevel"><a class="tocitem" href="#Assembling-global-residual-and-tangent-1"><span>Assembling global residual and tangent</span></a></li><li class="toplevel"><a class="tocitem" href="#Define-a-main-function,-with-a-loop-for-Newton-iterations-1"><span>Define a main function, with a loop for Newton iterations</span></a></li><li class="toplevel"><a class="tocitem" href="#Run-the-simulation-1"><span>Run the simulation</span></a></li><li><a class="tocitem" href="#test-the-result-#src-1"><span>test the result                #src</span></a></li></ul></li><li><a class="tocitem" href="../transmission_line/">Transmision line</a></li></ul></li><li><span class="tocitem">Algorithms</span><ul><li><a class="tocitem" href="../../../lib/algorithms/LGG09/">LGG09</a></li><li><a class="tocitem" href="../../../lib/algorithms/GLGM06/">GLGM06</a></li><li><a class="tocitem" href="../../../lib/algorithms/BFFPSV18/">BFFPSV18</a></li><li><a class="tocitem" href="../../../lib/algorithms/TMJets/">TMJets</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../../lib/flowpipes/">Flowpipes</a></li><li><a class="tocitem" href="../../../lib/solution_types/">Solution types</a></li><li><a class="tocitem" href="../../../lib/discretize/">Discretization</a></li></ul></li><li><a class="tocitem" href="../../../references/">References</a></li><li><a class="tocitem" href="../../../about/">About</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Applications</a></li><li class="is-active"><a href>Quadrotor altitude control</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Quadrotor altitude control</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/mforets/ReachabilityAnalysis.jl/blob/master/docs/src/man/applications/quadrotor.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="#-Hyperelasticity-1"><a class="docs-heading-anchor" href="##-Hyperelasticity-1"># Hyperelasticity</a><a class="docs-heading-anchor-permalink" href="##-Hyperelasticity-1" title="Permalink"></a></h1><h1 id="-1"><a class="docs-heading-anchor" href="#-1"></a><a class="docs-heading-anchor-permalink" href="#-1" title="Permalink"></a></h1><h1 id="**Keywords**:-*hyperelasticity*,-*finite-strain*,-*large-deformations*,-*Newton&#39;s-method*,-1"><a class="docs-heading-anchor" href="#**Keywords**:-*hyperelasticity*,-*finite-strain*,-*large-deformations*,-*Newton&#39;s-method*,-1"><strong>Keywords</strong>: <em>hyperelasticity</em>, <em>finite strain</em>, <em>large deformations</em>, <em>Newton&#39;s method</em>,</a><a class="docs-heading-anchor-permalink" href="#**Keywords**:-*hyperelasticity*,-*finite-strain*,-*large-deformations*,-*Newton&#39;s-method*,-1" title="Permalink"></a></h1><h1 id="*conjugate-gradient*,-*automatic-differentiation*-1"><a class="docs-heading-anchor" href="#*conjugate-gradient*,-*automatic-differentiation*-1"><em>conjugate gradient</em>, <em>automatic differentiation</em></a><a class="docs-heading-anchor-permalink" href="#*conjugate-gradient*,-*automatic-differentiation*-1" title="Permalink"></a></h1><h1 id="-2"><a class="docs-heading-anchor" href="#-2"></a><a class="docs-heading-anchor-permalink" href="#-2" title="Permalink"></a></h1><h1 id="AGREGAR-IMAGEN-DE-QUADROTOR-AQUI-1"><a class="docs-heading-anchor" href="#AGREGAR-IMAGEN-DE-QUADROTOR-AQUI-1">AGREGAR IMAGEN DE QUADROTOR AQUI</a><a class="docs-heading-anchor-permalink" href="#AGREGAR-IMAGEN-DE-QUADROTOR-AQUI-1" title="Permalink"></a></h1><p>#- #md # AGREGAR EL TIPO DE JUPYTER NOTEBOOK AQUI</p><h1 id="-3"><a class="docs-heading-anchor" href="#-3"></a><a class="docs-heading-anchor-permalink" href="#-3" title="Permalink"></a></h1><h1 id="In-this-example-we-will-solve-a-problem-in-a-finite-strain-setting-using-an-1"><a class="docs-heading-anchor" href="#In-this-example-we-will-solve-a-problem-in-a-finite-strain-setting-using-an-1">In this example we will solve a problem in a finite strain setting using an</a><a class="docs-heading-anchor-permalink" href="#In-this-example-we-will-solve-a-problem-in-a-finite-strain-setting-using-an-1" title="Permalink"></a></h1><h1 id="hyperelastic-material-model.-In-order-to-compute-the-stress-we-will-use-automatic-1"><a class="docs-heading-anchor" href="#hyperelastic-material-model.-In-order-to-compute-the-stress-we-will-use-automatic-1">hyperelastic material model. In order to compute the stress we will use automatic</a><a class="docs-heading-anchor-permalink" href="#hyperelastic-material-model.-In-order-to-compute-the-stress-we-will-use-automatic-1" title="Permalink"></a></h1><h1 id="differentiation,-to-solve-the-non-linear-system-we-use-Newton&#39;s-1"><a class="docs-heading-anchor" href="#differentiation,-to-solve-the-non-linear-system-we-use-Newton&#39;s-1">differentiation, to solve the non-linear system we use Newton&#39;s</a><a class="docs-heading-anchor-permalink" href="#differentiation,-to-solve-the-non-linear-system-we-use-Newton&#39;s-1" title="Permalink"></a></h1><h1 id="method,-and-for-solving-the-Newton-increment-we-use-conjugate-gradient.-1"><a class="docs-heading-anchor" href="#method,-and-for-solving-the-Newton-increment-we-use-conjugate-gradient.-1">method, and for solving the Newton increment we use conjugate gradient.</a><a class="docs-heading-anchor-permalink" href="#method,-and-for-solving-the-Newton-increment-we-use-conjugate-gradient.-1" title="Permalink"></a></h1><h1 id="-4"><a class="docs-heading-anchor" href="#-4"></a><a class="docs-heading-anchor-permalink" href="#-4" title="Permalink"></a></h1><h1 id="The-weak-format-is-expressed-in-terms-of-the-first-Piola-Kirchoff-stress-\\mathbf{P}-1"><a class="docs-heading-anchor" href="#The-weak-format-is-expressed-in-terms-of-the-first-Piola-Kirchoff-stress-\\mathbf{P}-1">The weak format is expressed in terms of the first Piola-Kirchoff stress <span>$\mathbf{P}$</span></a><a class="docs-heading-anchor-permalink" href="#The-weak-format-is-expressed-in-terms-of-the-first-Piola-Kirchoff-stress-\\mathbf{P}-1" title="Permalink"></a></h1><h1 id="as-follows:-Find-u-\\in-\\mathbb{U}-such-that-1"><a class="docs-heading-anchor" href="#as-follows:-Find-u-\\in-\\mathbb{U}-such-that-1">as follows: Find <span>$u \in \mathbb{U}$</span> such that</a><a class="docs-heading-anchor-permalink" href="#as-follows:-Find-u-\\in-\\mathbb{U}-such-that-1" title="Permalink"></a></h1><h1 id="-5"><a class="docs-heading-anchor" href="#-5"></a><a class="docs-heading-anchor-permalink" href="#-5" title="Permalink"></a></h1><h1 id="math-1"><a class="docs-heading-anchor" href="#math-1">```math</a><a class="docs-heading-anchor-permalink" href="#math-1" title="Permalink"></a></h1><h1 id="\\int_\\Omega-[\\delta-\\mathbf{u}-\\otimes-\\nabla]-:-\\mathbf{P}(\\mathbf{u})\\-\\mathrm{d}\\Omega-1"><a class="docs-heading-anchor" href="#\\int_\\Omega-[\\delta-\\mathbf{u}-\\otimes-\\nabla]-:-\\mathbf{P}(\\mathbf{u})\\-\\mathrm{d}\\Omega-1">\int_\Omega [\delta \mathbf{u} \otimes \nabla] : \mathbf{P}(\mathbf{u})\ \mathrm{d}\Omega =</a><a class="docs-heading-anchor-permalink" href="#\\int_\\Omega-[\\delta-\\mathbf{u}-\\otimes-\\nabla]-:-\\mathbf{P}(\\mathbf{u})\\-\\mathrm{d}\\Omega-1" title="Permalink"></a></h1><h1 id="\\int*\\Omega-\\delta-\\mathbf{u}-\\cdot-\\mathbf{b}\\-\\mathrm{d}\\Omega-\\int*{\\Gamma\\mathrm{N}}-1"><a class="docs-heading-anchor" href="#\\int*\\Omega-\\delta-\\mathbf{u}-\\cdot-\\mathbf{b}\\-\\mathrm{d}\\Omega-\\int*{\\Gamma\\mathrm{N}}-1">\int<em>\Omega \delta \mathbf{u} \cdot \mathbf{b}\ \mathrm{d}\Omega + \int</em>{\Gamma^\mathrm{N}}</a><a class="docs-heading-anchor-permalink" href="#\\int*\\Omega-\\delta-\\mathbf{u}-\\cdot-\\mathbf{b}\\-\\mathrm{d}\\Omega-\\int*{\\Gamma\\mathrm{N}}-1" title="Permalink"></a></h1><h1 id="\\mathbf{u}-\\cdot-\\mathbf{t}\\-\\mathrm{d}\\Gamma-1"><a class="docs-heading-anchor" href="#\\mathbf{u}-\\cdot-\\mathbf{t}\\-\\mathrm{d}\\Gamma-1">\mathbf{u} \cdot \mathbf{t}\ \mathrm{d}\Gamma</a><a class="docs-heading-anchor-permalink" href="#\\mathbf{u}-\\cdot-\\mathbf{t}\\-\\mathrm{d}\\Gamma-1" title="Permalink"></a></h1><h1 id="\\quad-\\forall-\\delta-\\mathbf{u}-\\in-\\mathbb{U}0,-1"><a class="docs-heading-anchor" href="#\\quad-\\forall-\\delta-\\mathbf{u}-\\in-\\mathbb{U}0,-1">\quad \forall \delta \mathbf{u} \in \mathbb{U}^0,</a><a class="docs-heading-anchor-permalink" href="#\\quad-\\forall-\\delta-\\mathbf{u}-\\in-\\mathbb{U}0,-1" title="Permalink"></a></h1><h1 id="-6"><a class="docs-heading-anchor" href="#-6">```</a><a class="docs-heading-anchor-permalink" href="#-6" title="Permalink"></a></h1><h1 id="-7"><a class="docs-heading-anchor" href="#-7"></a><a class="docs-heading-anchor-permalink" href="#-7" title="Permalink"></a></h1><h1 id="where-\\mathbf{u}-is-the-unknown-displacement-field,-\\mathbf{b}-is-the-body-force,-\\mathbf{t}-1"><a class="docs-heading-anchor" href="#where-\\mathbf{u}-is-the-unknown-displacement-field,-\\mathbf{b}-is-the-body-force,-\\mathbf{t}-1">where <span>$\mathbf{u}$</span> is the unknown displacement field, <span>$\mathbf{b}$</span> is the body force, <span>$\mathbf{t}$</span></a><a class="docs-heading-anchor-permalink" href="#where-\\mathbf{u}-is-the-unknown-displacement-field,-\\mathbf{b}-is-the-body-force,-\\mathbf{t}-1" title="Permalink"></a></h1><h1 id="is-the-traction-on-the-Neumann-part-of-the-boundary,-and-where-\\mathbb{U}-and-\\mathbb{U}0-are-1"><a class="docs-heading-anchor" href="#is-the-traction-on-the-Neumann-part-of-the-boundary,-and-where-\\mathbb{U}-and-\\mathbb{U}0-are-1">is the traction on the Neumann part of the boundary, and where <span>$\mathbb{U}$</span> and <span>$\mathbb{U}^0$</span> are</a><a class="docs-heading-anchor-permalink" href="#is-the-traction-on-the-Neumann-part-of-the-boundary,-and-where-\\mathbb{U}-and-\\mathbb{U}0-are-1" title="Permalink"></a></h1><h1 id="suitable-trial-and-test-sets.-1"><a class="docs-heading-anchor" href="#suitable-trial-and-test-sets.-1">suitable trial and test sets.</a><a class="docs-heading-anchor-permalink" href="#suitable-trial-and-test-sets.-1" title="Permalink"></a></h1><p>using JuAFEM, Tensors, TimerOutputs, ProgressMeter import KrylovMethods, IterativeSolvers</p><h1 id="##-Hyperelastic-material-model-1"><a class="docs-heading-anchor" href="###-Hyperelastic-material-model-1">## Hyperelastic material model</a><a class="docs-heading-anchor-permalink" href="###-Hyperelastic-material-model-1" title="Permalink"></a></h1><h1 id="-8"><a class="docs-heading-anchor" href="#-8"></a><a class="docs-heading-anchor-permalink" href="#-8" title="Permalink"></a></h1><h1 id="The-stress-can-be-derived-from-an-energy-potential,-defined-in-1"><a class="docs-heading-anchor" href="#The-stress-can-be-derived-from-an-energy-potential,-defined-in-1">The stress can be derived from an energy potential, defined in</a><a class="docs-heading-anchor-permalink" href="#The-stress-can-be-derived-from-an-energy-potential,-defined-in-1" title="Permalink"></a></h1><h1 id="terms-of-the-right-Cauchy-Green-tensor-\\mathbf{C}.-We-shall-use-a-neo-Hookean-model,-where-1"><a class="docs-heading-anchor" href="#terms-of-the-right-Cauchy-Green-tensor-\\mathbf{C}.-We-shall-use-a-neo-Hookean-model,-where-1">terms of the right Cauchy-Green tensor <span>$\mathbf{C}$</span>. We shall use a neo-Hookean model, where</a><a class="docs-heading-anchor-permalink" href="#terms-of-the-right-Cauchy-Green-tensor-\\mathbf{C}.-We-shall-use-a-neo-Hookean-model,-where-1" title="Permalink"></a></h1><h1 id="the-potential-can-be-written-as-1"><a class="docs-heading-anchor" href="#the-potential-can-be-written-as-1">the potential can be written as</a><a class="docs-heading-anchor-permalink" href="#the-potential-can-be-written-as-1" title="Permalink"></a></h1><h1 id="-9"><a class="docs-heading-anchor" href="#-9"></a><a class="docs-heading-anchor-permalink" href="#-9" title="Permalink"></a></h1><h1 id="math-2"><a class="docs-heading-anchor" href="#math-2">```math</a><a class="docs-heading-anchor-permalink" href="#math-2" title="Permalink"></a></h1><h1 id="\\Psi(\\mathbf{C})-\\frac{\\mu}{2}-(I_C-3)-\\mu-\\ln(J)-\\frac{\\lambda}{2}-\\ln(J)2,-1"><a class="docs-heading-anchor" href="#\\Psi(\\mathbf{C})-\\frac{\\mu}{2}-(I_C-3)-\\mu-\\ln(J)-\\frac{\\lambda}{2}-\\ln(J)2,-1">\Psi(\mathbf{C}) = \frac{\mu}{2} (I_C - 3) - \mu \ln(J) + \frac{\lambda}{2} \ln(J)^2,</a><a class="docs-heading-anchor-permalink" href="#\\Psi(\\mathbf{C})-\\frac{\\mu}{2}-(I_C-3)-\\mu-\\ln(J)-\\frac{\\lambda}{2}-\\ln(J)2,-1" title="Permalink"></a></h1><h1 id="-10"><a class="docs-heading-anchor" href="#-10">```</a><a class="docs-heading-anchor-permalink" href="#-10" title="Permalink"></a></h1><h1 id="-11"><a class="docs-heading-anchor" href="#-11"></a><a class="docs-heading-anchor-permalink" href="#-11" title="Permalink"></a></h1><h1 id="where-I_C-\\mathrm{tr}(C),-J-\\sqrt{\\det(C)}-and-\\mu-and-\\lambda-material-parameters.-1"><a class="docs-heading-anchor" href="#where-I_C-\\mathrm{tr}(C),-J-\\sqrt{\\det(C)}-and-\\mu-and-\\lambda-material-parameters.-1">where <span>$I_C = \mathrm{tr}(C)$</span>, <span>$J = \sqrt{\det(C)}$</span> and <span>$\mu$</span> and <span>$\lambda$</span> material parameters.</a><a class="docs-heading-anchor-permalink" href="#where-I_C-\\mathrm{tr}(C),-J-\\sqrt{\\det(C)}-and-\\mu-and-\\lambda-material-parameters.-1" title="Permalink"></a></h1><h1 id="From-the-potential-we-obtain-the-second-Piola-Kirchoff-stress-\\mathbf{S}-as-1"><a class="docs-heading-anchor" href="#From-the-potential-we-obtain-the-second-Piola-Kirchoff-stress-\\mathbf{S}-as-1">From the potential we obtain the second Piola-Kirchoff stress <span>$\mathbf{S}$</span> as</a><a class="docs-heading-anchor-permalink" href="#From-the-potential-we-obtain-the-second-Piola-Kirchoff-stress-\\mathbf{S}-as-1" title="Permalink"></a></h1><h1 id="-12"><a class="docs-heading-anchor" href="#-12"></a><a class="docs-heading-anchor-permalink" href="#-12" title="Permalink"></a></h1><h1 id="math-3"><a class="docs-heading-anchor" href="#math-3">```math</a><a class="docs-heading-anchor-permalink" href="#math-3" title="Permalink"></a></h1><h1 id="\\mathbf{S}-2-\\frac{\\partial-\\Psi}{\\partial-\\mathbf{C}},-1"><a class="docs-heading-anchor" href="#\\mathbf{S}-2-\\frac{\\partial-\\Psi}{\\partial-\\mathbf{C}},-1">\mathbf{S} = 2 \frac{\partial \Psi}{\partial \mathbf{C}},</a><a class="docs-heading-anchor-permalink" href="#\\mathbf{S}-2-\\frac{\\partial-\\Psi}{\\partial-\\mathbf{C}},-1" title="Permalink"></a></h1><h1 id="-13"><a class="docs-heading-anchor" href="#-13">```</a><a class="docs-heading-anchor-permalink" href="#-13" title="Permalink"></a></h1><h1 id="-14"><a class="docs-heading-anchor" href="#-14"></a><a class="docs-heading-anchor-permalink" href="#-14" title="Permalink"></a></h1><h1 id="and-the-tangent-of-\\mathbf{S}-as-1"><a class="docs-heading-anchor" href="#and-the-tangent-of-\\mathbf{S}-as-1">and the tangent of <span>$\mathbf{S}$</span> as</a><a class="docs-heading-anchor-permalink" href="#and-the-tangent-of-\\mathbf{S}-as-1" title="Permalink"></a></h1><h1 id="-15"><a class="docs-heading-anchor" href="#-15"></a><a class="docs-heading-anchor-permalink" href="#-15" title="Permalink"></a></h1><h1 id="math-4"><a class="docs-heading-anchor" href="#math-4">```math</a><a class="docs-heading-anchor-permalink" href="#math-4" title="Permalink"></a></h1><h1 id="\\frac{\\partial-\\mathbf{S}}{\\partial-\\mathbf{C}}-4-\\frac{\\partial-\\Psi}{\\partial-\\mathbf{C}}.-1"><a class="docs-heading-anchor" href="#\\frac{\\partial-\\mathbf{S}}{\\partial-\\mathbf{C}}-4-\\frac{\\partial-\\Psi}{\\partial-\\mathbf{C}}.-1">\frac{\partial \mathbf{S}}{\partial \mathbf{C}} = 4 \frac{\partial \Psi}{\partial \mathbf{C}}.</a><a class="docs-heading-anchor-permalink" href="#\\frac{\\partial-\\mathbf{S}}{\\partial-\\mathbf{C}}-4-\\frac{\\partial-\\Psi}{\\partial-\\mathbf{C}}.-1" title="Permalink"></a></h1><h1 id="-16"><a class="docs-heading-anchor" href="#-16">```</a><a class="docs-heading-anchor-permalink" href="#-16" title="Permalink"></a></h1><h1 id="-17"><a class="docs-heading-anchor" href="#-17"></a><a class="docs-heading-anchor-permalink" href="#-17" title="Permalink"></a></h1><h1 id="We-can-implement-the-material-model-as-follows,-where-we-utilize-automatic-differentiation-1"><a class="docs-heading-anchor" href="#We-can-implement-the-material-model-as-follows,-where-we-utilize-automatic-differentiation-1">We can implement the material model as follows, where we utilize automatic differentiation</a><a class="docs-heading-anchor-permalink" href="#We-can-implement-the-material-model-as-follows,-where-we-utilize-automatic-differentiation-1" title="Permalink"></a></h1><h1 id="for-the-stress-and-the-tangent,-and-thus-only-define-the-potential:-1"><a class="docs-heading-anchor" href="#for-the-stress-and-the-tangent,-and-thus-only-define-the-potential:-1">for the stress and the tangent, and thus only define the potential:</a><a class="docs-heading-anchor-permalink" href="#for-the-stress-and-the-tangent,-and-thus-only-define-the-potential:-1" title="Permalink"></a></h1><p>struct NeoHooke     μ::Float64     λ::Float64 end</p><p>function Ψ(C, mp::NeoHooke)     μ = mp.μ     λ = mp.λ     Ic = tr(C)     J = sqrt(det(C))     return μ / 2 * (Ic - 3) - μ * log(J) + λ / 2 * log(J)^2 end</p><p>function constitutive_driver(C, mp::NeoHooke)     ## Compute all derivatives in one function call     ∂²Ψ∂C², ∂Ψ∂C = Tensors.hessian(y -&gt; Ψ(y, mp), C, :all)     S = 2.0 * ∂Ψ∂C     ∂S∂C = 4.0 * ∂²Ψ∂C²     return S, ∂S∂C end;</p><h1 id="Finally,-for-the-finite-element-problem-we-need-\\mathbf{P}-and-1"><a class="docs-heading-anchor" href="#Finally,-for-the-finite-element-problem-we-need-\\mathbf{P}-and-1">Finally, for the finite element problem we need <span>$\mathbf{P}$</span> and</a><a class="docs-heading-anchor-permalink" href="#Finally,-for-the-finite-element-problem-we-need-\\mathbf{P}-and-1" title="Permalink"></a></h1><h1 id="\\frac{\\partial-\\mathbf{P}}{\\partial-\\mathbf{F}},-which-can-be-obtained-by-the-following-1"><a class="docs-heading-anchor" href="#\\frac{\\partial-\\mathbf{P}}{\\partial-\\mathbf{F}},-which-can-be-obtained-by-the-following-1"><span>$\frac{\partial \mathbf{P}}{\partial \mathbf{F}}$</span>, which can be obtained by the following</a><a class="docs-heading-anchor-permalink" href="#\\frac{\\partial-\\mathbf{P}}{\\partial-\\mathbf{F}},-which-can-be-obtained-by-the-following-1" title="Permalink"></a></h1><h1 id="transformations-1"><a class="docs-heading-anchor" href="#transformations-1">transformations</a><a class="docs-heading-anchor-permalink" href="#transformations-1" title="Permalink"></a></h1><h1 id="-18"><a class="docs-heading-anchor" href="#-18"></a><a class="docs-heading-anchor-permalink" href="#-18" title="Permalink"></a></h1><h1 id="math-5"><a class="docs-heading-anchor" href="#math-5">```math</a><a class="docs-heading-anchor-permalink" href="#math-5" title="Permalink"></a></h1><h1 id="\\begin{align*}-1"><a class="docs-heading-anchor" href="#\\begin{align*}-1">\begin{align*}</a><a class="docs-heading-anchor-permalink" href="#\\begin{align*}-1" title="Permalink"></a></h1><h1 id="\\mathbf{P}-and-\\mathbf{F}-\\cdot-\\mathbf{S},\\-1"><a class="docs-heading-anchor" href="#\\mathbf{P}-and-\\mathbf{F}-\\cdot-\\mathbf{S},\\-1">\mathbf{P} &amp;= \mathbf{F} \cdot \mathbf{S},\</a><a class="docs-heading-anchor-permalink" href="#\\mathbf{P}-and-\\mathbf{F}-\\cdot-\\mathbf{S},\\-1" title="Permalink"></a></h1><h1 id="\\frac{\\partial-\\mathbf{P}}{\\partial-\\mathbf{F}}-and-[\\mathbf{F}-\\bar{\\otimes}-\\mathbf{I}]-:-1"><a class="docs-heading-anchor" href="#\\frac{\\partial-\\mathbf{P}}{\\partial-\\mathbf{F}}-and-[\\mathbf{F}-\\bar{\\otimes}-\\mathbf{I}]-:-1">\frac{\partial \mathbf{P}}{\partial \mathbf{F}} &amp;= [\mathbf{F} \bar{\otimes} \mathbf{I}] :</a><a class="docs-heading-anchor-permalink" href="#\\frac{\\partial-\\mathbf{P}}{\\partial-\\mathbf{F}}-and-[\\mathbf{F}-\\bar{\\otimes}-\\mathbf{I}]-:-1" title="Permalink"></a></h1><h1 id="\\frac{\\partial-\\mathbf{S}}{\\partial-\\mathbf{C}}-:-[\\mathbf{F}\\mathrm{T}-\\bar{\\otimes}-\\mathbf{I}]-1"><a class="docs-heading-anchor" href="#\\frac{\\partial-\\mathbf{S}}{\\partial-\\mathbf{C}}-:-[\\mathbf{F}\\mathrm{T}-\\bar{\\otimes}-\\mathbf{I}]-1">\frac{\partial \mathbf{S}}{\partial \mathbf{C}} : [\mathbf{F}^\mathrm{T} \bar{\otimes} \mathbf{I}]</a><a class="docs-heading-anchor-permalink" href="#\\frac{\\partial-\\mathbf{S}}{\\partial-\\mathbf{C}}-:-[\\mathbf{F}\\mathrm{T}-\\bar{\\otimes}-\\mathbf{I}]-1" title="Permalink"></a></h1><h1 id="\\mathbf{I}-\\bar{\\otimes}-\\mathbf{S}.-1"><a class="docs-heading-anchor" href="#\\mathbf{I}-\\bar{\\otimes}-\\mathbf{S}.-1">+ \mathbf{I} \bar{\otimes} \mathbf{S}.</a><a class="docs-heading-anchor-permalink" href="#\\mathbf{I}-\\bar{\\otimes}-\\mathbf{S}.-1" title="Permalink"></a></h1><h1 id="\\end{align*}-1"><a class="docs-heading-anchor" href="#\\end{align*}-1">\end{align*}</a><a class="docs-heading-anchor-permalink" href="#\\end{align*}-1" title="Permalink"></a></h1><h1 id="-19"><a class="docs-heading-anchor" href="#-19">```</a><a class="docs-heading-anchor-permalink" href="#-19" title="Permalink"></a></h1><h1 id="-20"><a class="docs-heading-anchor" href="#-20"></a><a class="docs-heading-anchor-permalink" href="#-20" title="Permalink"></a></h1><h1 id="##-Finite-element-assembly-1"><a class="docs-heading-anchor" href="###-Finite-element-assembly-1">## Finite element assembly</a><a class="docs-heading-anchor-permalink" href="###-Finite-element-assembly-1" title="Permalink"></a></h1><h1 id="-21"><a class="docs-heading-anchor" href="#-21"></a><a class="docs-heading-anchor-permalink" href="#-21" title="Permalink"></a></h1><h1 id="The-element-routine-for-assembling-the-residual-and-tangent-stiffness-is-implemented-1"><a class="docs-heading-anchor" href="#The-element-routine-for-assembling-the-residual-and-tangent-stiffness-is-implemented-1">The element routine for assembling the residual and tangent stiffness is implemented</a><a class="docs-heading-anchor-permalink" href="#The-element-routine-for-assembling-the-residual-and-tangent-stiffness-is-implemented-1" title="Permalink"></a></h1><h1 id="as-usual,-with-loops-over-quadrature-points-and-shape-functions:-1"><a class="docs-heading-anchor" href="#as-usual,-with-loops-over-quadrature-points-and-shape-functions:-1">as usual, with loops over quadrature points and shape functions:</a><a class="docs-heading-anchor-permalink" href="#as-usual,-with-loops-over-quadrature-points-and-shape-functions:-1" title="Permalink"></a></h1><p>function assemble_element!(ke, ge, cell, cv, fv, mp, ue)     ## Reinitialize cell values, and reset output arrays     reinit!(cv, cell)     fill!(ke, 0.0)     fill!(ge, 0.0)</p><pre><code class="language-none">b = Vec{3}((0.0, -0.5, 0.0)) # Body force
t = Vec{3}((0.1, 0.0, 0.0)) # Traction
ndofs = getnbasefunctions(cv)

for qp in 1:getnquadpoints(cv)
    dΩ = getdetJdV(cv, qp)
    ## Compute deformation gradient F and right Cauchy-Green tensor C
    ∇u = function_gradient(cv, qp, ue)
    F = one(∇u) + ∇u
    C = tdot(F)
    ## Compute stress and tangent
    S, ∂S∂C = constitutive_driver(C, mp)
    P = F ⋅ S
    I = one(S)
    ∂P∂F = otimesu(F, I) ⊡ ∂S∂C ⊡ otimesu(F&#39;, I) + otimesu(I, S)

    ## Loop over test functions
    for i in 1:ndofs
        ## Test function + gradient
        δui = shape_value(cv, qp, i)
        ∇δui = shape_gradient(cv, qp, i)
        ## Add contribution to the residual from this test function
        ge[i] += ( ∇δui ⊡ P - δui ⋅ b ) * dΩ

        ∇δui∂P∂F = ∇δui ⊡ ∂P∂F # Hoisted computation
        for j in 1:ndofs
            ∇δuj = shape_gradient(cv, qp, j)
            ## Add contribution to the tangent
            ke[i, j] += ( ∇δui∂P∂F ⊡ ∇δuj ) * dΩ
        end
    end
end

## Surface integral for the traction
for face in 1:nfaces(cell)
    if onboundary(cell, face)
        reinit!(fv, cell, face)
        for q_point in 1:getnquadpoints(fv)
            dΓ = getdetJdV(fv, q_point)
            for i in 1:ndofs
                δui = shape_value(fv, q_point, i)
                ge[i] -= (δui ⋅ t) * dΓ
            end
        end
    end
end</code></pre><p>end;</p><h1 id="Assembling-global-residual-and-tangent-1"><a class="docs-heading-anchor" href="#Assembling-global-residual-and-tangent-1">Assembling global residual and tangent</a><a class="docs-heading-anchor-permalink" href="#Assembling-global-residual-and-tangent-1" title="Permalink"></a></h1><p>function assemble<em>global!(K, f, dh, cv, fv, mp, u)     n = ndofs</em>per_cell(dh)     ke = zeros(n, n)     ge = zeros(n)</p><pre><code class="language-none">## start_assemble resets K and f
assembler = start_assemble(K, f)

## Loop over all cells in the grid
@timeit &quot;assemble&quot; for cell in CellIterator(dh)
    global_dofs = celldofs(cell)
    ue = u[global_dofs] # element dofs
    @timeit &quot;element assemble&quot; assemble_element!(ke, ge, cell, cv, fv, mp, ue)
    assemble!(assembler, global_dofs, ge, ke)
end</code></pre><p>end;</p><h1 id="Define-a-main-function,-with-a-loop-for-Newton-iterations-1"><a class="docs-heading-anchor" href="#Define-a-main-function,-with-a-loop-for-Newton-iterations-1">Define a main function, with a loop for Newton iterations</a><a class="docs-heading-anchor-permalink" href="#Define-a-main-function,-with-a-loop-for-Newton-iterations-1" title="Permalink"></a></h1><p>function solve()     reset_timer!()</p><pre><code class="language-none">## Generate a grid
N = 10
L = 1.0
left = zero(Vec{3})
right = L * ones(Vec{3})
grid = generate_grid(Tetrahedron, (N, N, N), left, right)

## Material parameters
E = 10.0
ν = 0.3
μ = E / (2(1 + ν))
λ = (E * ν) / ((1 + ν) * (1 - 2ν))
mp = NeoHooke(μ, λ)

## Finite element base
ip = Lagrange{3, RefTetrahedron, 1}()
qr = QuadratureRule{3, RefTetrahedron}(1)
qr_face = QuadratureRule{2, RefTetrahedron}(1)
cv = CellVectorValues(qr, ip)
fv = FaceVectorValues(qr_face, ip)

## DofHandler
dh = DofHandler(grid)
push!(dh, :u, 3) # Add a displacement field
close!(dh)

function rotation(X, t, θ = deg2rad(60.0))
    x, y, z = X
    return t * Vec{3}(
        (0.0,
        L/2 - y + (y-L/2)*cos(θ) - (z-L/2)*sin(θ),
        L/2 - z + (y-L/2)*sin(θ) + (z-L/2)*cos(θ)
        ))
end

dbcs = ConstraintHandler(dh)
## Add a homogenous boundary condition on the &quot;clamped&quot; edge
dbc = Dirichlet(:u, getfaceset(grid, &quot;right&quot;), (x,t) -&gt; [0.0, 0.0, 0.0], [1, 2, 3])
add!(dbcs, dbc)
dbc = Dirichlet(:u, getfaceset(grid, &quot;left&quot;), (x,t) -&gt; rotation(x, t), [1, 2, 3])
add!(dbcs, dbc)
close!(dbcs)
t = 0.5
JuAFEM.update!(dbcs, t)

## Pre-allocation of vectors for the solution and Newton increments
_ndofs = ndofs(dh)
un = zeros(_ndofs) # previous solution vector
u  = zeros(_ndofs)
Δu = zeros(_ndofs)
ΔΔu = zeros(_ndofs)
apply!(un, dbcs)

## Create sparse matrix and residual vector
K = create_sparsity_pattern(dh)
g = zeros(_ndofs)


## Perform Newton iterations
newton_itr = -1
NEWTON_TOL = 1e-8
prog = ProgressMeter.ProgressThresh(NEWTON_TOL, &quot;Solving:&quot;)

while true; newton_itr += 1
    u .= un .+ Δu # Current guess
    assemble_global!(K, g, dh, cv, fv, mp, u)
    normg = norm(g[JuAFEM.free_dofs(dbcs)])
    apply_zero!(K, g, dbcs)
    ProgressMeter.update!(prog, normg; showvalues = [(:iter, newton_itr)])

    if normg &lt; NEWTON_TOL
        break
    elseif newton_itr &gt; 30
        error(&quot;Reached maximum Newton iterations, aborting&quot;)
    end

    ## Compute increment using cg! from IterativeSolvers.jl
    @timeit &quot;linear solve (KrylovMethods.cg)&quot; ΔΔu′, flag, relres, iter, resvec = KrylovMethods.cg(K, g; maxIter = 1000)
    @assert flag == 0
    @timeit &quot;linear solve (IterativeSolvers.cg!)&quot; IterativeSolvers.cg!(ΔΔu, K, g; maxiter=1000)

    apply_zero!(ΔΔu, dbcs)
    Δu .-= ΔΔu
end

## Save the solution
@timeit &quot;export&quot; begin
    vtk_grid(&quot;hyperelasticity&quot;, dh) do vtkfile
        vtk_point_data(vtkfile, dh, u)
    end
end

print_timer(title = &quot;Analysis with $(getncells(grid)) elements&quot;, linechars = :ascii)
return u</code></pre><p>end</p><h1 id="Run-the-simulation-1"><a class="docs-heading-anchor" href="#Run-the-simulation-1">Run the simulation</a><a class="docs-heading-anchor-permalink" href="#Run-the-simulation-1" title="Permalink"></a></h1><p>u = solve();</p><h2 id="test-the-result-#src-1"><a class="docs-heading-anchor" href="#test-the-result-#src-1">test the result                #src</a><a class="docs-heading-anchor-permalink" href="#test-the-result-#src-1" title="Permalink"></a></h2><p>using Test                        #src @test norm(u) ≈ 4.865189736192834 #src</p><p>#md # ## Plain Program #md # #md # Below follows a version of the program without any comments. #md # The file is also available here: .... #md # #md # <code>julia #md # @__CODE__ #md #</code></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../embrake/">« Electromechanic break</a><a class="docs-footer-nextpage" href="../transmission_line/">Transmision line »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 12 March 2020 22:41">Thursday 12 March 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
